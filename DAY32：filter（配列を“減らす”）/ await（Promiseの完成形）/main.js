// ğŸŸ¢ DAY32ï¼šfilterï¼ˆé…åˆ—ã‚’â€œæ¸›ã‚‰ã™â€ï¼‰

// ğŸ¯ ä»Šæ—¥ã®ãƒ†ãƒ¼ãƒï¼ˆè¶…é‡è¦ï¼‰

// filter ã¯ã€Œæ¡ä»¶ã«åˆã†ã‚‚ã®ã ã‘æ®‹ã™ã€

// data ã‚’ç›´æ¥ã„ã˜ã‚‰ãªã„

// æ–°ã—ã„é…åˆ—ã‚’ä½œã‚‹

// è¡¨ç¤ºå¯¾è±¡ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã‚ã«ä½¿ã†

// ğŸ§  ã¾ãšã‚¤ãƒ¡ãƒ¼ã‚¸

// state.dataï¼ˆå…¨éƒ¨ï¼‰
// â†“ filter
// æ¡ä»¶ã«åˆã†ã‚‚ã®ã ã‘
// â†“
// ç”»é¢ã«è¡¨ç¤º


// â‘  çŠ¶æ…‹ç®¡ç†ï¼ˆstateï¼‰
// çŠ¶æ…‹ã‚’1ç®‡æ‰€ã«ã¾ã¨ã‚ã‚‹

//ç”»é¢ã®çŠ¶æ…‹ã‚’ï¼‘ã¤ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆstateï¼‰ã§ç®¡ç†ã™ã‚‹
//ä»Šã€€ã€Œèª­ã¿è¾¼ã¿ä¸­ã‹ã€ã€Œã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹ã‹ã€ã€Œè¡¨ç¤ºã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã€ã‚’ã¾ã¨ã‚ã¦æŒã¤
const state = {
    loading: false,//true:èª­ã¿è¾¼ã¿ä¸­â†’Loadingè¡¨ç¤º
    error:null,//ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆãªã‘ã‚Œã°nullï¼‰
    data:[]//æ­£å¸¸æ™‚ã«è¡¨ç¤ºã™ã‚‹APIã‹ã‚‰å–å¾—ã—ãŸä¸€è¦§ãƒ‡ãƒ¼ã‚¿
    
};


// â‘¡ UIæç”»é–¢æ•°ï¼ˆçŠ¶æ…‹ã«å¿œã˜ã¦ç”»é¢è¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ï¼‰

//function å‡¦ç†ã«åå‰ã¤ã‘ã¦ã€€renderStatusé–¢æ•°ï¼å‡¦ç†ã®ã¾ã¨ã¾ã‚Šã‚’ä½œã‚‹
// ç”»é¢ä¸Šã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºï¼ˆLoading / Errorï¼‰ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
function renderStatus(){

    //statusã‚’ä½œæˆã—ã¦DOMã§JSã‹ã‚‰HTMLã‚’å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«idã‚’å–å¾—ã™ã‚‹
    const status = document.getElementById("status");
//ifæ–‡ã§æ¡ä»¶åˆ†å²ã™ã‚‹

//state.loadingâ†’èª­ã¿è¾¼ã¿ä¸­ã®å ´åˆã¯ã€Loadingãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
    if(state.loading) {
        //stateãŒtrueãªã‚‰Loadingä¸­HTMLã¸ã®è¡¨ç¤ºã‚’å¤‰ãˆã‚‹ãŸã‚textContentã‚’ä½¿ã£ã¦Loadingè¡¨ç¤º
        status.textContent = "Loading...";
        //Loadingã®è¨˜è¿°ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚returnã§HTMLã®statusã¸è¿”ã™
        return;// ã“ã‚Œä»¥ä¸Šä¸‹ã®åˆ¤å®šã‚’ã—ãªã„
    }
    //stateãŒã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹å ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹HTMLã¸ã®è¡¨ç¤ºã‚’å¤‰ãˆã‚‹ãŸã‚textContentã‚’ä½¿ã£ã¦errorè¡¨ç¤º
    if(state.error) {
        status.textContent = state.error;
        //errorã®è¨˜è¿°ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚returnã§HTMLã®statusã¸è¿”ã™
        return;// ã“ã‚Œä»¥ä¸Šä¸‹ã®åˆ¤å®šã‚’ã—ãªã„
    }


    //ãƒ‡ãƒ¼ã‚¿ãŒå–ã‚Œã¦ã‚¨ãƒ©ãƒ¼ã‚‚ãªããƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚‚çµ‚ã‚ã£ã¦ã‚‹ã‘ã©ã€ä¸­èº«ãŒç©º
    //è¡¨ç¤ºãªã—ã‹ã‚‰ã€Œãƒ‡ãƒ¼ã‚¿ãªã—ã€ã¨ã€Œãƒ‡ãƒ¼ã‚¿ã‚ã‚Šã€ã«åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸ
    if(state.data.length === 0) {
        status.textContent = "ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“";
        return;
    }


    // Loadingã§ã‚‚Errorã§ã‚‚ãªã„å ´åˆã¯ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ¶ˆã™
     status.textContent = "";
}


// â‘¢ æŠ•ç¨¿ä¸€è¦§ã‚’æç”»ã™ã‚‹é–¢æ•°
//state.data ã«å…¥ã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢ã®ä¸€è¦§ã¨ã—ã¦è¡¨ç¤ºã—ç›´ã™
function renderList() {
    // ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ ul è¦ç´ list idã‚’å–å¾—
    const ul = document.getElementById("list");
    // ulå†…ã®è¡¨ç¤ºã‚’ä¸€åº¦ãƒªã‚»ãƒƒãƒˆã™ã‚‹ï¼ˆå‰ã®è¡¨ç¤ºãŒæ®‹ã‚‹ã¨äºŒé‡è¡¨ç¤ºã«ãªã‚‹ã‹ã‚‰ï¼‰
    ul.innerHTML = "";
    //data é…åˆ—ã‚’ä¸€ä»¶ãšã¤å–ã‚Šå‡ºã—ã¦å‡¦ç†ã™ã‚‹
    //dataã®ä¸­èº«ã‚’ï¼‘å€‹ãšã¤itemã¨ã—ã¦å–ã‚Šå‡ºã™
    state.data.forEach(item =>{
         // liè¦ç´ ã‚’æ–°ã—ãä½œæˆ
        const li = document.createElement("li");
        // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã® title ã‚’è¡¨ç¤º
        li.textContent = item.title;
        // ulã®ä¸­ã«liã‚’è¿½åŠ ã™ã‚‹
        ul.appendChild(li);
    });
}

//DAY32
//--------------------------------------------------

// DAY32: æŠ•ç¨¿ã‚’çµã‚Šè¾¼ã‚€é–¢æ•°
function filterPosts(){
    //userIdãŒï¼‘ã®æŠ•ç¨¿ã ã‘æ®‹ã™
    return state.data.filter(post => post.userId === 1);
}

//ã“ã“è¶…é‡è¦ğŸ‘‡

//state.data ã¯ å¤‰æ›´ã—ã¦ãªã„
//filter ã®æˆ»ã‚Šå€¤ã‚’ä½¿ã£ã¦ã‚‹ã ã‘

//â‘¡ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼çµæœã‚’è¡¨ç¤ºã™ã‚‹

function renderFilteredList(){
    const filteredPosts = filterPosts();
    //JSã‹ã‚‰HTMLè¦ç´ ã‚’å–å¾—ã™ã‚‹ã€€ul list
    const ul = document.getElementById("list");
    //é‡è¤‡ã‚’é˜²ããŸã‚ulã®ä¸­èº«ã¯ä¸€æ—¦ãªãã™
    ul.innerHTML = "";

    //ulã®liã®ä¸­èº«ã®é…åˆ—ã‚’1å€‹ãšã¤å‡¦ç†ã™ã‚‹
    filteredPosts.forEach(post =>{
        //JSã‹ã‚‰HTMLè¦ç´ ã‚’å–å¾—ã™ã‚‹ ul li
        const li = document.createElement("li");
        //liã‚’post.titleã«ç½®ãæ›ãˆã‚‹
        li.textContent = post.title;
        //ä½œã£ãŸ li ã‚’ ul ã®å­è¦ç´ ã¨ã—ã¦è¿½åŠ ã™ã‚‹â†’ ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹
        ul.appendChild(li);
    });

}


// â‘¢ ãƒœã‚¿ãƒ³ã‚’1å€‹ã ã‘ç”¨æ„ï¼ˆHTMLï¼‰
// <button id="filterBtn">userId = 1</button>


//â‘£ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¡¨ç¤º
document.getElementById("filterBtn").addEventListener("click",()=>{
    renderFilteredList();
});

// âœ… å‹•ä½œç¢ºèªï¼ˆã“ã“å¿…ãšï¼‰
// åˆæœŸè¡¨ç¤º

// fetchPosts å®Ÿè¡Œ

// å…¨ä»¶è¡¨ç¤ºã•ã‚Œã‚‹

// ãƒœã‚¿ãƒ³æŠ¼ã™

// ä¸€è¦§ãŒæ¸›ã‚‹

// userId === 1 ã ã‘ã«ãªã‚‹

// ğŸ¯ ä»Šæ—¥ã®ã‚´ãƒ¼ãƒ«ï¼ˆå£°ã«å‡ºã—ã¦OKï¼‰

// ã“ã‚ŒãŒè¨€ãˆãŸã‚‰DAY32ã‚¯ãƒªã‚¢ğŸ‘‡

// filter ã¯
// ã€Œå…ƒãƒ‡ãƒ¼ã‚¿ã‚’å£Šã•ãšã«
// è¡¨ç¤ºç”¨ã®é…åˆ—ã‚’ä½œã‚‹ãŸã‚ã®é“å…·ã€

//-----------------------------------------------------

//ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã€çŠ¶æ…‹ã‚’æ›´æ–°ã—ã¦ã€UIã‚’å†æç”»ã™ã‚‹
//â€» UIãã®ã‚‚ã®ã¯æã‹ãªã„ğŸ‘‰ çŠ¶æ…‹ã‚’å¤‰ãˆã‚‹å¸ä»¤å¡”
// fetchPosts() å…¨ä½“ã®æµã‚Œï¼ˆæ—¥æœ¬èªï¼‰
// â‘  ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹
// â‘¡ ã‚¨ãƒ©ãƒ¼åˆæœŸåŒ–
// â‘¢ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°
// â‘£ APIé€šä¿¡
// â‘¤ æˆåŠŸ â†’ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼†ä¸€è¦§è¡¨ç¤º
// â‘¥ å¤±æ•— â†’ ã‚¨ãƒ©ãƒ¼ä¿å­˜
// â‘¦ æœ€å¾Œã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµ‚äº†ï¼†è¡¨ç¤ºæ›´æ–°

//APIã‹ã‚‰æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€çŠ¶æ…‹ã¨UIã‚’æ›´æ–°ã™ã‚‹éåŒæœŸé–¢æ•°
async function fetchPosts(){
    // â‘  ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹ï¼ˆé€šä¿¡å‰ï¼‰
    state.loading = true;
    //â‘¡ ã‚¨ãƒ©ãƒ¼åˆæœŸåŒ– å‰å›ã®ã‚¨ãƒ©ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
    state.error = null;
    //â‘¢ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºæ›´æ–°(çŠ¶æ…‹ã«å¿œã˜ã¦)
    renderStatus();

    try{
        // APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
        const res = await fetch("https://jsonplaceholder.typicode.com/posts");
        //// resãŒokã˜ã‚ƒãªã‹ã£ãŸå ´åˆã€HTTPã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã¨ã—ã¦æ‰±ã†
        if(!res.ok){
            throw new Error("é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }
        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’JSONã«å¤‰æ›
        const data = await res.json();
        // å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’stateã«ä¿å­˜
        state.data = data;
        // ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã€ä¸€è¦§è¡¨ç¤ºã‚’æ›´æ–°
        renderList();
        
    } catch(err){
        //// ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’stateã«ä¿å­˜
        state.error = err.message;
    } finally {
        // æˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµ‚äº†
        state.loading = false ;
        // æœ€çµ‚çš„ãªçŠ¶æ…‹ã«å¿œã˜ã¦ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
        renderStatus();
    }
    //ãªãœ finally ã« loading = false ãŒã‚ã‚‹ï¼Ÿ

    // ğŸ‘‰ æˆåŠŸã§ã‚‚å¤±æ•—ã§ã‚‚å¿…ãšãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’çµ‚ã‚ã‚‰ã›ãŸã„ã‹ã‚‰

    // tryï¼šæˆåŠŸãƒ«ãƒ¼ãƒˆ

    // catchï¼šå¤±æ•—ãƒ«ãƒ¼ãƒˆ

    // finallyï¼šã©ã£ã¡ã§ã‚‚é€šã‚‹

    // ï¼ UIãŒå£Šã‚Œãªã„

}

fetchPosts();





// ğŸ§  å…¨ä½“æ§‹é€ ï¼ˆã¾ãšä¿¯ç°ï¼‰
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚ fetchPosts()  â”‚   â† ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»åˆ¤æ–­ï¼ˆãƒ­ã‚¸ãƒƒã‚¯ï¼‰
// â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
//         â”‚
//         â–¼
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚     state       â”‚   â† ä»Šã®ç”»é¢ã®çŠ¶æ…‹
// â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
// â”‚ loading : true/false
// â”‚ error   : null / message
// â”‚ data    : [] / posts
// â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
//         â”‚
//         â–¼
// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
// â”‚      UIæç”»é–¢æ•°         â”‚
// â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
// â”‚  â”‚ renderStatus() â”‚     â”‚
// â”‚  â”‚  ãƒ»Loading     â”‚     â”‚
// â”‚  â”‚  ãƒ»Error       â”‚     â”‚
// â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
// â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
// â”‚  â”‚ renderList()   â”‚     â”‚
// â”‚  â”‚  ãƒ»ä¸€è¦§è¡¨ç¤º    â”‚     â”‚
// â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// ğŸ” renderStatus ã¨ renderList ã®å½¹å‰²åˆ†æ‹…
// renderStatus()
// state.loading === true
//         â†“
// ã€ŒLoading...ã€è¡¨ç¤º

// state.error ãŒã‚ã‚‹
//         â†“
// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

// ã©ã¡ã‚‰ã§ã‚‚ãªã„
//         â†“
// ä½•ã‚‚è¡¨ç¤ºã—ãªã„


// ğŸ‘‰ ã€Œä»Šã®çŠ¶æ…‹ã€ã‚’æ–‡ç« ã§ä¼ãˆã‚‹UI

// renderList()
// state.data ã«ãƒ‡ãƒ¼ã‚¿ãŒå…¥ã‚‹
//         â†“
// ul ã‚’ç©ºã«ã™ã‚‹
//         â†“
// 1ä»¶ãšã¤ li ã‚’ä½œã‚‹
//         â†“
// ä¸€è¦§ã¨ã—ã¦è¡¨ç¤º

// ğŸ‘‰ ã€Œãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã€ã‚’è¦‹ã›ã‚‹UI

// ğŸ§© 2ã¤ã®é–¢ä¿‚ï¼ˆè¶…é‡è¦ï¼‰
// âŒ ã‚„ã£ã¦ãªã„ã“ã¨

// renderStatus ã¯ data ã‚’è¦‹ãªã„

// renderList ã¯ loading / error ã‚’è¦‹ãªã„

// ğŸ‘‰ ãŠäº’ã„ã®é ˜åŸŸã«å¹²æ¸‰ã—ãªã„

// â­• æ­£ã—ã„é–¢ä¿‚
//         state
//        /     \
//       â–¼       â–¼
// renderStatus  renderList


// ğŸ‘‰ å…±é€šã®stateã‚’è¦‹ã‚‹ã ã‘

// ğŸ” æ™‚ç³»åˆ—ã§è¦‹ã‚‹ã¨ï¼ˆè¶…ç†è§£ã—ã‚„ã™ã„ï¼‰
// â‘  fetché–‹å§‹
// state.loading = true
// state.error = null

// renderStatus() â†’ ã€ŒLoading...ã€
// renderList()   â†’ ã¾ã å‘¼ã°ã‚Œãªã„

// â‘¡ æˆåŠŸæ™‚
// state.data = data
// state.loading = false

// renderList()   â†’ ä¸€è¦§è¡¨ç¤º
// renderStatus() â†’ è¡¨ç¤ºã‚¯ãƒªã‚¢

// â‘¢ å¤±æ•—æ™‚
// state.error = "é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ"
// state.loading = false

// renderStatus() â†’ ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
// renderList()   â†’ å‘¼ã°ã‚Œãªã„

// ğŸ§  ä¸€è¨€ã§è¨€ã†ã¨

// fetchPostsï¼šå¸ä»¤å¡”

// stateï¼šæ²ç¤ºæ¿

// renderStatusï¼šçŠ¶æ³èª¬æ˜ä¿‚

// renderListï¼šçµæœè¡¨ç¤ºä¿‚